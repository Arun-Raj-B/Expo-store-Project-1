<section
  style="background-color: #ece6d9; padding-top: 250px; padding-bottom: 250px"
>
  <div class="container h-75 d-flex justify-content-center align-items-center">
    <div class="position-relative">
      <div
        class="card card-work p-2 shadow text-center"
        style="width: 22rem; height: 18rem"
      >
        <form action="/loginOTP" method="post" id="formValidation">
          <div class="pt-3">
            <i class="display-3 fa-solid fa-mobile text-secondary"></i>
            <!-- <p class="text-danger m-auto">locals.OTPerr</p> -->
            <span class="d-block"
              >Enter the OTP sent to <%=locals.mobile %>
            </span>
          </div>
          <div class="inputs d-flex flex-row justify-content-center mt-2">
            <input
              class="m-2 text-center form-control rounded"
              type="number"
              name="OTP"
              required
            />
          </div>
          <% if (locals.errMsg) { %>
          <p class="text-danger m-auto"><%=locals.errMsg %></p>
          <% } %>
          <div class="mt-3 pb-2">
            <button type="submit" class="btn btn-outline-secondary px-4">
              Submit
            </button>
          </div>
          <a
            id="resendOTP"
            class="text-success text-decoration-none"
            style="cursor: pointer; display: none"
          >
            Resend OTP (<span id="OTPcount"></span>/3)
          </a>
          <div id="otp-text">
            Resend OTP in <span id="timer"></span> seconds
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"
></script>

<script
  text="text/javascript"
  src="/users/javascript/signupValidation.js"
></script>

<script>
  let seconds = 10;
  let timer;
  let OTPcount = 0;
  console.log(timer);
  function myFunction() {
    if (seconds < 10) {
      // I want it to say 1:00, not 60
      document.getElementById("timer").innerHTML = seconds;
    }
    if (seconds > 0) {
      // so it doesn't go to -1
      seconds--;
    } else {
      clearInterval(timer);
      document.getElementById("OTPcount").innerHTML = OTPcount++;
      document.getElementById("resendOTP").style.display = "block";
      document.getElementById("otp-text").style.display = "none";
    }
  }

  function counter() {
    console.log("working");
    if (!timer) {
      console.log("timer working");
      timer = window.setInterval(function () {
        myFunction();
      }, 1000); // every second
    }
  }
  document.getElementById("timer").innerHTML = "10";

  //to start counter when the page loads
  counter();

  document.getElementById("resendOTP").onclick = function () {
    if (OTPcount == "4") {
      window.location.href = "/login";
    } else {
      $.ajax({
        url: "/resendOTP",
        method: "post",
        success: (response) => {
          console.log(response);
          timer = false;
          seconds = 10;
          document.getElementById("timer").innerHTML = "10";
          document.getElementById("resendOTP").style.display = "none";
          document.getElementById("otp-text").style.display = "block";
          counter();
        },
      });
    }
  };
</script>
